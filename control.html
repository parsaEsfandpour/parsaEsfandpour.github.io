<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        label {
            font-weight: bold;
        }
        input, button {
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Control Panel</h1>
        <label for="price">Set New Price:</label>
        <input type="number" id="price" placeholder="Enter new price (e.g., 1.5)">
        <button onclick="updatePrice()">Update Price</button>
        <p id="status" style="color: green; margin-top: 10px;"></p>
    </div>

    <script>
        const binId = "675c8aebad19ca34f8daa962"; // جایگزین با Bin ID
        const apiKey = "$2a$10$lWvaajk30.H4dyNjvBP68eqM7vkgvMP9O5YAvi7pTeKkIJrXfUwMK"; // جایگزین با API Key

        async function updatePrice() {
            const price = parseFloat(document.getElementById('price').value);
            if (!price || isNaN(price)) {
                document.getElementById('status').innerText = 'Please enter a valid price.';
                return;
            }

            try {
                // دریافت داده‌های فعلی
                const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                    headers: { 'X-Master-Key': apiKey },
                });
                const result = await response.json();
                const data = result.record;

                // افزودن قیمت جدید
                const lastData = data[data.length - 1];
                const nextTime = new Date(new Date(lastData.time).getTime() + 86400000).toISOString().split('T')[0];

                const newCandle = {
                    time: nextTime,
                    open: lastData.close,
                    high: Math.max(price, lastData.close),
                    low: Math.min(price, lastData.close),
                    close: price,
                };

                data.push(newCandle);

                // ذخیره داده‌ها
                await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': apiKey,
                    },
                    body: JSON.stringify(data),
                });

                document.getElementById('status').innerText = `Price updated to $${price}`;
            } catch (error) {
                console.error("Failed to update price:", error);
                document.getElementById('status').innerText = 'Failed to update price.';
            }
        }
    </script>
</body>
</html>